---
import "@styles/reset.css";
import "@styles/base.css";
import "@styles/global.css";

const {
  title = "Designer Danya Vidmich",
  description = "Graphic and product designer. Ex Badoo, Yandex Music, Yandex Go and Art. Lebedev Studio. Making media Lug. Co-founded dating app Apt",
  keywords = "graphic design, product design, Danya Vidmich, portfolio, designer, yandex go, yandex music, badoo, apt app, apt, vidmich, daniil vidmich, даня видмич, даниил видмич, видмич, дизайнер, арт-директор, art director, cv, studio, works, cases, identity, branding, web, mobile, merch",
  author = "Danya Vidmich",
  ogTitle = "Danya Vidmich. Graphic and product design",
  ogDescription = description,
  ogType = "website",
  ogUrl = "https://danyavidmich.com",
  ogImage = "https://danyavidmich.com/Union.png",
  twitterCard = "summary_large_image",
  preloadFonts = true
} = Astro.props;
---

<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <meta name="author" content={author} />

    <meta property="og:type" content={ogType} />
    <meta property="og:title" content={ogTitle} />
    <meta property="og:description" content={ogDescription} />
    <meta property="og:url" content={ogUrl} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content={ogTitle} />

    <meta name="twitter:card" content={twitterCard} />
    <meta name="twitter:title" content={ogTitle} />
    <meta name="twitter:description" content={ogDescription} />
    <meta name="twitter:image" content={ogImage} />

    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="canonical" href={ogUrl} />
    
    {/* Preconnect to external resources */}
    <link rel="preconnect" href="https://player.vimeo.com" crossorigin />
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin />
    <link rel="preconnect" href="https://mc.yandex.ru" crossorigin />

    {preloadFonts && (
      <>
        <link rel="preload" href="/fonts/arialnarrow.ttf" as="font" type="font/ttf" crossorigin="anonymous" fetchpriority="high" />
      </>
    )}

    <slot name="head" />
    
    {/* JSON-LD structured data */}
    <script type="application/ld+json" is:inline set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Danya Vidmich",
      "alternateName": "Daniil Vidmich",
      "jobTitle": "Multidisciplinary Design Lead",
      "description": description,
      "url": ogUrl,
      "sameAs": [
        "https://www.linkedin.com/in/vidmichd/",
        "https://t.me/dvtel"
      ],
      "knowsAbout": [
        "Graphic Design",
        "Product Design",
        "Brand Identity",
        "Digital Marketing",
        "UI/UX Design"
      ],
      "alumniOf": [
        {
          "@type": "Organization",
          "name": "Art. Lebedev Studio"
        }
      ],
      "worksFor": [
        {
          "@type": "Organization",
          "name": "Yandex Practicum"
        }
      ]
    })} />
  </head>
  <body>
    <slot />
    <script is:inline src="/javascript.js" defer></script>
    <script src="/scripts/image-error-handler.js" defer></script>
    <script is:inline>
      // Register service worker (deferred to not block page load)
      if ('serviceWorker' in navigator) {
        // Use requestIdleCallback if available, otherwise setTimeout
        const registerSW = () => {
          navigator.serviceWorker.register('/sw.js', { updateViaCache: 'none' })
            .then((registration) => {
              // Check for updates periodically
              setInterval(() => {
                registration.update();
              }, 3600000); // Every hour
            })
            .catch(() => {
              // Service worker registration failed
            });
        };

        if ('requestIdleCallback' in window) {
          requestIdleCallback(registerSW, { timeout: 5000 });
        } else {
          setTimeout(registerSW, 3000);
        }
      }
    </script>
    <script>
        // Initialize error tracking (only in production with DSN) - deferred
        if (import.meta.env.PUBLIC_SENTRY_DSN && import.meta.env.PROD) {
          const initSentryAsync = () => {
            import('/src/utils/sentry.ts').then(({ initSentry }) => {
              initSentry();
            }).catch(() => {
              // Silently fail if Sentry can't be loaded
            });
          };

          if ('requestIdleCallback' in window) {
            requestIdleCallback(initSentryAsync, { timeout: 5000 });
          } else {
            setTimeout(initSentryAsync, 3000);
          }
        }
    </script>
  </body>
</html>

